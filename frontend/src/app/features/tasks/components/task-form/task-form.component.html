<div class="form-container">
  <div class="form-card">
    <header class="form-header">
      <h1>{{ isEditMode ? 'Edit Task' : 'Create New Task' }}</h1>
      <button 
        class="back-button" 
        (click)="navigateBack()"
        type="button"
        [disabled]="isLoading"
      >
        ‚Üê Back to Dashboard
      </button>
    </header>

    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
      <div class="form-group">
        <label for="title" class="form-label">
          Task Title <span class="required">*</span>
        </label>
        <input
          id="title"
          type="text"
          formControlName="title"
          class="form-control"
          [class.error]="isFieldInvalid('title')"
          placeholder="Enter a descriptive title for your task"
          maxlength="100"
        />
        <div class="field-info">
          <span class="char-count">
            {{ taskForm.get('title')?.value?.length || 0 }}/100
          </span>
        </div>
        <div class="error-text" *ngIf="isFieldInvalid('title')">
          {{ getFieldError('title') }}
        </div>
      </div>

      <div class="form-group">
        <label for="description" class="form-label">
          Task Description <span class="required">*</span>
        </label>
        <textarea
          id="description"
          formControlName="description"
          class="form-control textarea"
          [class.error]="isFieldInvalid('description')"
          placeholder="Provide a detailed description of what needs to be done"
          rows="6"
          maxlength="1000"
        ></textarea>
        <div class="field-info">
          <span class="char-count">
            {{ taskForm.get('description')?.value?.length || 0 }}/1000
          </span>
        </div>
        <div class="error-text" *ngIf="isFieldInvalid('description')">
          {{ getFieldError('description') }}
        </div>
      </div>

      <div class="form-group" *ngIf="isEditMode">
        <label for="status" class="form-label">
          Task Status
        </label>
        <select
          id="status"
          formControlName="status"
          class="form-control"
        >
          <option *ngFor="let status of taskStatuses" [value]="status">
            {{ getStatusLabel(status) }}
          </option>
        </select>
        <div class="field-help">
          Change the status to track progress on this task
        </div>
      </div>

      <app-error-message [message]="errorMessage"></app-error-message>

      <div class="form-actions">
        <button
          type="button"
          class="cancel-button"
          (click)="navigateBack()"
          [disabled]="isLoading"
        >
          Cancel
        </button>
        
        <button
          type="submit"
          class="submit-button"
          [disabled]="taskForm.invalid || isLoading"
        >
          <span *ngIf="!isLoading">
            {{ isEditMode ? 'Update Task' : 'Create Task' }}
          </span>
          <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>
        </button>
      </div>
    </form>

    <div class="form-preview" *ngIf="taskForm.valid && !isLoading">
      <h3>Preview</h3>
      <div class="preview-card">
        <div class="preview-header">
          <h4>{{ taskForm.get('title')?.value }}</h4>
          <div 
            class="preview-status" 
            *ngIf="isEditMode"
            [style.background-color]="getStatusColor(taskForm.get('status')?.value)"
          >
            {{ getStatusLabel(taskForm.get('status')?.value) }}
          </div>
        </div>
        <p class="preview-description">{{ taskForm.get('description')?.value }}</p>
      </div>
    </div>
  </div>
</div>